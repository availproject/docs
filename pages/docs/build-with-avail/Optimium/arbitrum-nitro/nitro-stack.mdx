import { Callout } from 'nextra/components'

# Deploy Arbitrum Orbit with Avail DA

### Prerequisites

1. You need to have [docker](https://docs.docker.com/engine/) and [docker-compose](https://docs.docker.com/compose/) installed on your machine.
2. An Avail account with some AVAIL tokens in it. You can refer to [our docs here](/docs/end-user-guide/accounts) to get started.
3. At least 1 ETH over Arbsepolia Testnet. You can follow [Step 1](https://docs.arbitrum.io/launch-orbit-chain/orbit-quickstart#step-1-acquire-arbitrum-testnet-eth-and-the-native-token-for-orbit-chains-with-custom-gas-tokens) on Arbitrum Orbit Doc for acquiring testnet $ETH
4. This guide will use [Arbitrum's ArbSepolia](https://docs.arbitrum.io/build-decentralized-apps/public-chains#arbitrum-sepolia) and [Avail's Turing](/docs/networks) testnets.

<Callout type="info">
This guide is based on [Arbitrum Orbit Quickstart](https://docs.arbitrum.io/launch-orbit-chain/orbit-quickstart)
</Callout>

## Download avail nitro node docker image

### Step-1: Download the [avail-nitro-node](https://hub.docker.com/repository/docker/availrishabh/avail-nitro-node-dev/tags) image from docker hub
    
    ```bash
    docker pull availj/avail-nitro-node:v1.0.0-upstream-v2.3.1
    ```
    

## Deploy Rollup Contracts

### Step-1: Download the [nitro-contract](https://github.com/availproject/nitro-contracts/tree/data-availability-verification-v2.3.1) with Avail DA 
    
    ```bash
    git clone https://github.com/availproject/nitro-contracts.git
    cd nitro-contracts
    git checkout deprecated-avail-nitro-contracts-v1.2.1
    yarn install
    yarn build
    ```
    
### Step-2: Create `.env` file
    Create a copy of `.env.sample` as `.env` file and edit the following:
    
    - Set Rollup Creator Address `0xADCBE5c221566FA6e6Ebf5BA08759c83177DfCDA` at `ROLLUP_CREATOR_ADDRESS` 
    ```bash
    ROLLUP_CREATOR_ADDRESS="0xADCBE5c221566FA6e6Ebf5BA08759c83177DfCDA"
    ```

    - Add the private key of a well funded ArbSepolia account in `DEVNET_PRIVKEY`
    ```bash
    DEVNET_PRIVKEY="<--Private-key-->"
    ```
    
### Step-3: Create `.script/config.ts` file
  
  Create a copy of `scripts/config.ts.example` as  `scripts/config.ts` and set this config file with required configurations where `wasmModuleRoot` must be this based on your CPU architecture.
    
    ```jsx
    // for amd64
    wasmModuleRoot:'0xc3d6717b86468b20ed2d74fa4484571b51595d56294d154b0fac19d55b599e09'
    // for arm64
    wasmModuleRoot:'0x30d81f66d40dbb88484524cbce0982ee9adee944d9416c283313560efd5af958'
    ```
<Callout emoji="⚠️" type="info">
If you're not sure what CPU architecture you're using, you can find it by entering the following in your terminal:
```bash
  uname -m
```
</Callout>


    ```jsx
    config = {
      rollupConfig: {
      confirmPeriodBlocks: ethers.BigNumber.from('45818'),
      extraChallengeTimeBlocks: ethers.BigNumber.from('200'),
      stakeToken: ethers.constants.AddressZero,
      baseStake: ethers.utils.parseEther('0.0001'),
      wasmModuleRoot:
        '0x30d81f66d40dbb88484524cbce0982ee9adee944d9416c283313560efd5af958',
      owner: '0x1234123412341234123412341234123412341234',
      loserStakeEscrow: ethers.constants.AddressZero,
      chainId: ethers.BigNumber.from('20121999'),
      chainConfig:
        '{"chainId":20121999,"homesteadBlock":0,"daoForkBlock":null,"daoForkSupport":true,"eip150Block":0,"eip150Hash":"0x0000000000000000000000000000000000000000000000000000000000000000","eip155Block":0,"eip158Block":0,"byzantiumBlock":0,"constantinopleBlock":0,"petersburgBlock":0,"istanbulBlock":0,"muirGlacierBlock":0,"berlinBlock":0,"londonBlock":0,"clique":{"period":0,"epoch":0},"arbitrum":{"EnableArbOS":true,"AllowDebugPrecompiles":false,"DataAvailabilityCommittee":false,"InitialArbOSVersion":10,"InitialChainOwner":"0xd41996ED89bb5BF7dBfB181D8D93E8067446200B","GenesisBlockNum":0}}',
      genesisBlockNum: ethers.BigNumber.from('0'),
      sequencerInboxMaxTimeVariation: {
        delayBlocks: ethers.BigNumber.from('5760'),
        futureBlocks: ethers.BigNumber.from('12'),
        delaySeconds: ethers.BigNumber.from('86400'),
        futureSeconds: ethers.BigNumber.from('3600'),
      },
    },
    },
    validators: [
      '0x1234123412341234123412341234123412341234',
    ],
    batchPosters: ['0x1234123412341234123412341234123412341234',],
    batchPosterManager: '0x1234123412341234123412341234123412341234'

    ```

  The below table provides a brief description of each of these configuration parameters.
  
   **We recommend sticking to the defaults (the config provided above)**.
  
  To learn more about customizing your Orbit chain's deployment configuration, visit [**How (and when) to customize your Orbit chain's deployment config**](https://docs.arbitrum.io/launch-orbit-chain/how-tos/customize-deployment-configuration):

  | Parameter | Description |
  | --- | --- |
  | Chain ID(chainID) | A unique integer identifier that represents your chain's network. Your Chain ID can be submitted to chain indexes like http://chainlist.org/. For devnets, this is randomly generated for each deployment - don't worry about it for now. |
  | Challenge period (confirmPeriodBlocks) | The amount of time that your Orbit chain's nodes have to dispute the current state of the chain before it's confirmed (and ultimately finalized) on the underlying L2 chain (e.g. Arbitrum Sepolia). Note that this refers to the number of blocks on the underlying L1 chain (e.g. Ethereum's Sepolia chain). |
  | Stake token(stakeToken) | The token that your chain's validators must stake in order to participate in your chain. This is hardcoded to $ETH for now, but future versions of Orbit chains will let you specify an arbitrary ERC-20 token contract here. |
  | Base stake(baseStacke) | The amount of your configured Stake token that your chain's validators must stake in order to participate in your chain. Should be greater than 0. |
  | Owner(owner) | The administrative Ethereum address that will deploy, own, and update your chain's base contracts. This will default to your connected wallet's address. This needs to be a standard Ethereum wallet account - an EOA, not a contract address. Note that you'll have to specify this wallet's private key within a local JSON file later. |
  | Gas token | The address of the ERC-20 token on the parent chain that is intended to be used as the native gas token on the Orbit chain. This token must already be deployed natively on the parent chain and is bridged to the Orbit chain during chain deployment. This feature is only supported on AnyTrust chains currently, and more information around token restrictions can be found https://docs.arbitrum.io/launch-orbit-chain/how-tos/customize-deployment-configuration. |
  | Validators | Your chain's validators are responsible for validating the integrity of transactions and posting assertions of the current state of your Orbit chain to its base chain. Add the address in the list which you want to be added to an allow-list in your chain’s base contract  |
  | Batch Poster | Your batch poster address is responsible for posting batches of transactions from your Orbit chain to its base contracts on its base chain. Added the address which you want to act as batch-poster for your orbit chain |

<Callout type="info">
When we say "base contracts" and "base chain", we're referring to your Orbit chain's L2 contracts and the L2 chain that they're deployed to, respectively. We'll use these terms throughout the rest of this guide.
</Callout>

    
### Step-4: Deploy your chain's base contracts to Arbitrum Sepolia!
    
    ```bash
    yarn run deploy-eth-rollup --network arbSepolia
    ```
  You will get to see your chain’s base contracts addresses, which will be need in next step to fill in `nodeConfig.json` 
<br/>
<img src="/img/nitro-stack.png" alt="nitro-stack" width="100%"/>
  <br/>
  Before proceeding, let's briefly review what just happened:
  - You submitted a deployment transaction to an Orbit "factory" smart contract on the Arbitrum testnet, the public L2 chain that your local Orbit chain will settle transactions to.
- This Orbit smart contract then initialized your Orbit chain's base contracts with the values that you specified in the previous step, and deployed these base contracts to the Arbitrum testnet.

Your Orbit chain's base contracts are responsible for facilitating the exchange of information between your chain's node(s) and its base chain's nodes. This includes the batch posting of transactions from your Orbit chain to its base chain, the staking of tokens by your Orbit chain's validators the challenge mechanism, bridging mechanisms, and more.

## Spin up the chain using orbit-setup-script

### Step-1: Download [orbit-setup-script](https://github.com/OffchainLabs/orbit-setup-script.git)
    
    ```bash
    git clone https://github.com/OffchainLabs/orbit-setup-script.git
    cd orbit-setup-script
    ```
    
### Step-2: Add the `nodeConfig.json` in `./config`
  This is the nodeConfig.json file, encapsulating your chain's node configuration. It is crucial as it contains the private keys for your validator and batch poster, essential for signing transactions for RBlocks and batch postings to your chain's base contracts on the L2 chain.
    ```json
    {
      "chain": {
        "info-json": "[{\"chain-id\":<Insert your chain-id>,\"parent-chain-id\":421614,\"parent-chain-is-arbitrum\":true,\"chain-name\":\"<Insert chain name>\",\"chain-config\":{\"homesteadBlock\":0,\"daoForkBlock\":null,\"daoForkSupport\":true,\"eip150Block\":0,\"eip150Hash\":\"0x0000000000000000000000000000000000000000000000000000000000000000\",\"eip155Block\":0,\"eip158Block\":0,\"byzantiumBlock\":0,\"constantinopleBlock\":0,\"petersburgBlock\":0,\"istanbulBlock\":0,\"muirGlacierBlock\":0,\"berlinBlock\":0,\"londonBlock\":0,\"clique\":{\"period\":0,\"epoch\":0},\"arbitrum\":{\"EnableArbOS\":true,\"AllowDebugPrecompiles\":false,\"DataAvailabilityCommittee\":false,\"InitialArbOSVersion\":11,\"GenesisBlockNum\":0,\"MaxCodeSize\":24576,\"MaxInitCodeSize\":49152,\"InitialChainOwner\":\"<Insert chain owner address>\"},\"chainId\":<Insert chain id>},\"rollup\":{\"bridge\":\"<Bridge proxy address>\",\"inbox\":\"<Inbox address>\",\"sequencer-inbox\":\"<Sequencer inbox address>\",\"rollup\":\"<Rollup proxy address>\",\"validator-utils\":\"<Validator until address>\",\"validator-wallet-creator\":\"<Validator wallet creator address>\",\"deployed-at\":<Insert deployed-at block number>}}]",
        "name": "<Insert chain name>"
      },
      "parent-chain": {
        "connection": {
          "url": "https://sepolia-rollup.arbitrum.io/rpc"
        }
      },
      "http": {
        "addr": "0.0.0.0",
        "port": 8449,
        "vhosts": [
          "*"
        ],
        "corsdomain": [
          "*"
        ],
        "api": [
          "eth",
          "net",
          "web3",
          "arb",
          "debug"
        ]
      },
      "node": {
        "sequencer": true,
        "delayed-sequencer": {
          "enable": true,
          "use-merge-finality": false,
          "finalize-distance": 1
        },
        "batch-poster": {
          "max-size": 90000,
          "enable": true,
          "parent-chain-wallet": {
            "private-key": "<Insert your private key here>"
          }
        },
        "staker": {
          "enable": true,
          "strategy": "MakeNodes",
          "parent-chain-wallet": {
            "private-key": "<Insert your private key here>"
          }
        },
        "dangerous": {
          "no-sequencer-coordinator": true
        },
        "avail": {
          "enable": true,
          "seed": "<Enter your seed phrase here>",
          "avail-api-url": "wss://turing-rpc.avail.so/ws",
          "app-id": "<Enter your avail app id>",
          "timeout":"100s",
          "vectorx": "0xA712dfec48AF3a78419A8FF90fE8f97Ae74680F0",
          "arbSepolia-rpc": "<Enter an arbSepolia wss url here>"
        }
      },
      "execution": {
        "forwarding-target": "",
        "sequencer": {
          "enable": true,
          "max-tx-data-size": 85000,
          "max-block-speed": "250ms"
        },
        "caching": {
          "archive": true
        }
      }
    }

    ```

<Callout type="info">
    Make sure to update these params based on your chain's configuration and base contract addresses  

  <details className="border p-3 rounded-md bg-[#EFF6FF] border-[#] hover:!bg-[#EFF6FF]">
  <summary>
  List of params to be configured
  </summary>
    - `chain.chain-id`
    - `chain.chain-name`
    - `chain.InitialChainOwner`
    - `chain.chainId`
    - `chain.rollup`
    - `chain.name`
    - `node.batch-poster.parent-chain-wallet.private-key`
    - `node.staker.parent-chain-wallet.private-key`
    - `node.avail.seed`
    - `node.avail.app-id`
    - `node.avail.arbSepolia-rpc`

  </details>
</Callout>

### Step-3: Update `docker-compose` file of `orbit-setup-script`
    
    ```json
    ...
    nitro:
      image: availj/avail-nitro-node:v1.0.0-upstream-v2.3.1
      ports:
    ...
    ```
    
### Step-4: Run your chain
    
    ```bash
    cd orbit-setup-script
    docker-compose up -d
    ```
    
    A Nitro node and BlockScout explorer instance will be started. Visit **[http://localhost:4000/](http://localhost:4000/)** to access your BlockScout explorer instance - this will allow you to view your chain's transactions and blocks, which can be useful for debugging.
    

# Hurray!

**Congratulations,** Your local Orbit chain with Avail DA is now running.

#### Appendix A: Logging
Run this command in the root directory of your orbit setup script repo to view your chain's logs:
```bash
docker-compose logs -f nitro
```

#### Appendix B: Depositing ETH/native token
If you need to deposit more ETH (or native tokens) into your Orbit chain account, run this command on the base directory of the setup script, replacing `0xYourPrivateKey` with the private key of the originating account, and `<AMOUNT>` with the amount to send:

Using Arbitrum Sepolia:
```bash
PRIVATE_KEY="0xYourPrivateKey" L2_RPC_URL="https://sepolia-rollup.arbitrum.io/rpc" L3_RPC_URL="http://localhost:8449"
AMOUNT="<AMOUNT>" yarn run deposit
```

#### Appendix C: Troubleshooting
You may see error getting latest batch count in your node's output logs (from Appendix A). This is usually safe to ignore. It's usually displayed when your Orbit chain's base contract deployment isn't yet finalized on the L1 chain. This finalization can take 15-20 minutes, but don't worry - the deployment doesn't need to be L1-finalized in order for your chain to function properly.

Learn more about customizing and using your Orbit chain from the [Arbitrum Orbit Docs](https://docs.arbitrum.io/launch-orbit-chain/orbit-gentle-introduction). 